{% extends 'base.html' %}
{% block title %}{{ profile_user.username }}'s Profile{% endblock %}

{% block content %}
<div class="container my-5">

    <!-- PROFILE HEADER -->
    <div class="d-flex align-items-center mb-4">
        <img src="{{ profile_user.photo.url }}" class="rounded-circle shadow"
             style="width:110px;height:110px;object-fit:cover;">

        <div class="ms-3">

            <!-- Username + Bio -->
            <h3 class="mb-1">@{{ profile_user.username }}</h3>
            <p class="text-muted mb-2"><i class="fa-regular fa-user me-1"></i>{{ profile_user.bio|default:"No bio yet" }}</p>

            <!-- Stats Row -->
            <div class="d-flex gap-4 mb-2">
                <div>
                    <i class="fa-solid fa-image me-1"></i>
                    <strong>{{ posts.count }}</strong> Posts
                </div>
                <div>
                    <a href="{% url 'view_friends' profile_user.id %}" class="text-dark text-decoration-none">
                        <i class="fa-solid fa-users me-1"></i>
                        <strong>{{ profile_user.friends.count }}</strong> Friends
                    </a>
                </div>
            </div>

            <!-- Friend Action Button -->
            {% if user.id != profile_user.id %}
                <div class="mt-2">
                    {% if is_friend %}
                        <!-- Already Friends -->
                        <a href="{% url 'unfriend' profile_user.id %}" class="btn btn-outline-danger btn-sm px-4">
                            <i class="fa-solid fa-user-minus me-1"></i> Unfriend
                        </a>
                    {% else %}
                        <!-- Not Friends: Add Friend -->
                        <a href="{% url 'friend' profile_user.id %}" class="btn btn-primary btn-sm px-4">
                            <i class="fa-solid fa-user-plus me-1"></i> Add Friend
                        </a>
                    {% endif %}
                </div>
            {% endif %}

        </div>
    </div>

    <hr>

    <!-- POSTS SECTION -->
    <h5 class="mb-3"><i class="fa-solid fa-image me-2"></i>Posts</h5>

    {% if posts %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
            {% for post in posts %}
            <div class="col">
                <a href="{% url 'view_post' post.id %}" class="text-decoration-none text-dark">
                    <div class="card shadow-sm h-100 border-0">

                        <!-- Post Image -->
                        <img src="{{ post.image.url }}" class="card-img-top"
                             style="height:250px;object-fit:cover;">

                        <div class="card-body d-flex flex-column">
                            <p class="mb-2">{{ post.description|truncatewords:12 }}</p>
                            <div class="mt-auto d-flex justify-content-between align-items-center small text-muted">
                                <span><i class="fa-solid fa-heart me-1 text-danger"></i> {{ post.likes.count }}</span>
                                <span><i class="fa-regular fa-comment me-1"></i> {{ post.comments.count }}</span>
                            </div>
                        </div>

                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted"><i class="fa-regular fa-face-frown me-1"></i>This user has no posts yet.</p>
    {% endif %}

</div>
{% endblock %}